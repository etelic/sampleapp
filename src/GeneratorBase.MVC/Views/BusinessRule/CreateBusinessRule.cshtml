@model GeneratorBase.MVC.Models.BusinessRule
@{
    ViewBag.Title = "Create Business Rule";
}

    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-title">
                <i class="glyphicon glyphicon-plus-sign text-primary"></i> Business Rule  <i class="glyphicon glyphicon-chevron-right small"></i> <span>Create</span>
                @Html.ActionLink("Back To List", "Cancel", new { UrlReferrer = ViewData["BusinessRuleParentUrl"] }, new { @class = "btn btn-default btn-sm small pull-right" })
            </h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <link href='@Url.Content("~/Scripts/summernote.css")' rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/summernote.js")" type="text/javascript"></script>
    <script type="text/javascript">
    $(document).ready(function () {
        $('#AlertMessage').summernote();
    });
    </script>
    <script type="text/javascript" language="javascript">
    function FillSugestedValues() {
        var text = $("#" + "SuggestedPropertyValue option:selected").text();
        $("#" + "ConditionValue").val(text);
    }
    function FillSugestedValues7() {
        var text = $("#" + "SuggestedPropertyValue7 option:selected").text();
        $("#" + "Rule7Value").val(text);
    }
    function FillSugestedDynamicValues7() {
        $("#" + "Rule7Value").val('');
        var text = $("#" + "SuggestedDynamicValue7 option:selected").text();
        if ($("#" + "SuggestedDynamicValue71").val() != null && $("#" + "SuggestedDynamicValue71").val().length > 0) {
            var value = "[" + $("#" + "SuggestedDynamicValue7").val() + "." + $("#" + "SuggestedDynamicValue71").val() + "]";
            $("#" + "Rule7Value").val(value);
        }
        else {
            var value = "[" + $("#" + "SuggestedDynamicValue7").val() + "]";
            $("#" + "Rule7Value").val(value);
        }
    }
    function GetConstantValue() {
        //Rule7Operator
        var SelectedProperty = $("#" + "PropertyList7").val();
        var SelectedEntity = $('#EntityName').val();
        if (SelectedEntity.length == 0) {
            alert("Please select an Entity first !");
            return false;
        }
        if (SelectedProperty.length == 0) {
            alert("Please select a Property !");
            return false;
        }
        $("#" + "dvRule7Value").hide();
        $("#" + "Rule7Value").hide();
        $("#" + "dvRule7DynamicValue").hide();
        if ($("#Rule7Operator").val() == "1") {
            $("#" + "Rule7Value").val('');
            $("#" + "Rule7Value").show();
        }
        if ($("#Rule7Operator").val() == "2") {
            $.ajax({
                url: '@Url.Action("GetDropdown", "BusinessRule")' + '?Entity=' + SelectedEntity + '&Property=' + SelectedProperty,
                type: "GET",
                cache: false,
                success: function (result) {
                    if (result != "Failure") {
                        $("#" + "dvRule7Value").show();
                        $("#" + "SuggestedPropertyValue7").addClass('chosen-select form-control');
                        $("#" + "SuggestedPropertyValue7").attr("HostingName", result);
                        $("#" + "SuggestedPropertyValue7").attr("dataurl", '@Url.Action("GetAllValue", "_Entity", null)'.replace("_Entity", result));
                    }
                    else {
                        alert("Supports only association values.");
                        $("#" + "Rule7Value").show();
                        $("#" + "SuggestedPropertyValue7").removeClass = "chosen-select form-control";
                        $("#" + "SuggestedPropertyValue7").removeAttr("HostingName");
                        $("#" + "SuggestedPropertyValue7").removeAttr("dataurl");
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("error");
                }
            });
        }
        if ($("#Rule7Operator").val() == "3") {
            $("#" + "dvRule7DynamicValue").show();
            GetSecondLevelAttribute();
        }
    }
    function GetSecondLevelAttribute() {
        var SelectedEntity = $('#EntityName').val();
        var SelectedProperty = $("#" + "SuggestedDynamicValue7").val();

        $("#" + "SuggestedDynamicValue71").hide();
        $("#" + "SuggestedDynamicValue71").html('');

        $.ajax({
            url: '@Url.Action("GetAttributesofTargetEntity", "BusinessRule")' + '?Entity=' + SelectedEntity + '&AttributeName=' + SelectedProperty,
            type: "GET",
            cache: false,
            success: function (result) {
                var optionDOM = "";
                for (i = 0; i < result.length; i++) {
                    optionDOM += '<option value="' + result[i].Name + '">' + result[i].DisplayName + '</option>';
                }

                if (result.length == 0) {
                    $("#" + "SuggestedDynamicValue71").html('');
                    $("#" + "SuggestedDynamicValue71").hide();
                }
                else {
                    $("#" + "SuggestedDynamicValue71").show();
                    $("#" + "SuggestedDynamicValue71").html(optionDOM);
                }
                FillSugestedDynamicValues7();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("error");
            }
        })
    }
    function GetSuggestedValues(obj) {
        if ($("#OperatorList option:selected").text() == "Pick From List") {
            var SelectedProperty = $("#" + "PropertyList").val();
            var SelectedEntity = $('#EntityName').val();
            if (SelectedEntity.length == 0) {
                alert("Please select an Entity first !");
                return false;
            }
            if (SelectedProperty.length == 0) {
                alert("Please select a Property !");
                return false;
            }
            $.ajax({
                url: '@Url.Action("GetDropdown", "BusinessRule")' + '?Entity=' + SelectedEntity + '&Property=' + SelectedProperty,
                type: "GET",
                cache: false,
                success: function (result) {
                    if (result != "Failure") {
                        $("#" + "dvSuggestedPropertyValue").show();
                        $("#" + "ConditionValue").hide();
                        $("#" + "SuggestedPropertyValue").addClass('chosen-select form-control');
                        $("#" + "SuggestedPropertyValue").attr("HostingName", result);
                        $("#" + "SuggestedPropertyValue").attr("dataurl", '@Url.Action("GetAllValue", "_Entity", null)'.replace("_Entity", result));
                    }
                    else {
                        alert("Supports only association values.")
                        $("#" + "dvSuggestedPropertyValue").hide();
                        $("#" + "ConditionValue").show();
                        $("#" + "SuggestedPropertyValue").removeClass = "chosen-select form-control";
                        $("#" + "SuggestedPropertyValue").removeAttr("HostingName");
                        $("#" + "SuggestedPropertyValue").removeAttr("dataurl");
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("error");
                }
            });
        }
        else { $("#" + "dvSuggestedPropertyValue").hide(); $("#" + "ConditionValue").show(); }
    }
    function closealert() {
        $('#dvalert').attr("class", "modal fade");
        $('#dvalert').attr("aria-hidden", "true");
        $('#dvalert').attr("style", "display:none;");
    }
    function deleteRow(obj) {
        var obj_tr = $(obj).closest("tr");
        $("#" + $(obj).attr("name")).val("");
        obj_tr.remove();
    }
    function AddConditionInGrid() {
        if ($("#ConditionValue").val() == undefined || $("#ConditionValue").val().length == 0) {
            //alert("Provide criteria value");
            $('#dvalert').attr("class", "modal fade in");
            $('#dvalert').attr("aria-hidden", "false");
            $('#dvalert').attr("style", "display:block;");
            $('#alertbody').html("<li>Provide criteria value</li>");
            return false;
        }
        // $('#rulecondition').validate();
        var str = "<tr>";
        var val1Text = $("#PropertyList option:selected").text();
        var val1 = $("#PropertyList").val();
        var val2 = $("#OperatorList").val();
        var val3 = $("#ConditionValue").val();
        str += "<td>" + val1Text + "</td>";
        str += "<td>" + val2 + "</td>";
        str += "<td>" + val3 + "</td>";
        str += "<td><i name=\"lblrulecondition\" onclick=\"deleteRow(this);\" class=\"fam-delete\"></i></td>";
        var val = $("#lblrulecondition").val();
        val += val1 + "," + val2 + "," + val3 + "?";
        $("#lblrulecondition").val(val);
        $('#tblConditionList').show();
        $('#tblConditionList').append(str);
    }
    function AddActionInGrid(action) {
        if (action == "ruletype4")
            if ($("#TimeValue").val().length == 0 || ($("#cmbNotifyTo").val() == undefined)) {
                // alert("Provide required information to add action !");
                $('#dvalert').attr("class", "modal fade in");
                $('#dvalert').attr("aria-hidden", "false");
                $('#dvalert').attr("style", "display:block;");
                $('#alertbody').html("<li>Provide required information to add action !</li>");
                return false;
            }
        if (action == "ruletype23")
            if ($("#PropertyList1").val() == undefined) {
                $('#dvalert').attr("class", "modal fade in");
                $('#dvalert').attr("aria-hidden", "false");
                $('#dvalert').attr("style", "display:block;");
                $('#alertbody').html("<li>Select atleast one property !</li>");
                return false;
            }
        if (action == "ruletype5")
            if ($("#Dropdown").val() == undefined) {
                $('#dvalert').attr("class", "modal fade in");
                $('#dvalert').attr("aria-hidden", "false");
                $('#dvalert').attr("style", "display:block;");
                $('#alertbody').html("<li>Select atleast one dropdown to filter !</li>");
                return false;
            }
        if (action == "ruletype7")
            if ($("#PropertyList7").val() == undefined) {
                $('#dvalert').attr("class", "modal fade in");
                $('#dvalert').attr("aria-hidden", "false");
                $('#dvalert').attr("style", "display:block;");
                $('#alertbody').html("<li>Select atleast one property !</li>");
                return false;
            }
        if (action == "ruletype8")
            if ($("#EntityVerb").val() == undefined) {
                $('#dvalert').attr("class", "modal fade in");
                $('#dvalert').attr("aria-hidden", "false");
                $('#dvalert').attr("style", "display:block;");
                $('#alertbody').html("<li>Select atleast one verb !</li>");
                return false;
            }
        var str = "<tr>";
        var type = "";
        if (action == "ruletype5") {
            if ($("#ActionList").val() == '5') {
                str += "<td>Filter Dropdown</td>";
                type = '5';
            }
            var val = $("#Dropdown").val();
            var DropdownVal = $("#Dropdown option:selected").map(function () {
                return $(this).text();
            }).get().join();
            str += "<td>" + DropdownVal + "</td>";
            $("#lblruletype" + type).val(val);
            $("#Dropdown option:selected").removeAttr("selected");
            $("#Dropdown").multiselect('rebuild');
        }
        else {
            if (action == "ruletype23") {
                if ($("#ActionList").val() == '3') {
                    str += "<td>Mandatory Properties</td>";
                    type = '3';
                }
                else if ($("#ActionList").val() == '6') {
                    str += "<td>Hidden Properties</td>";
                    type = '6';
                }
                else {
                    str += "<td>ReadOnly Properties</td>";
                    type = '2';
                }
                var option_all = $("#PropertyList1 option:selected").map(function () {
                    return $(this).text();
                }).get().join();
                var val = $("#PropertyList1").val();
                str += "<td>" + option_all + "</td>";
                $("#lblruletype" + type).val(val);
                $("#PropertyList1 option:selected").removeAttr("selected");
                $("#PropertyList1").multiselect('rebuild');
            } else {
                if (action == "ruletype4") {
                    var valNotify = "";
                    for (var o = 0; o < $('#NotifyRoleList option:selected').length; o++) {
                        valNotify += $('#NotifyRoleList option:selected')[o].text + ",";
                    }
                    str += "<td>Email Notification</td>";
                    var val1 = $("#cmbNotifyTo").val();
                    str += "<td>Notify To :- " + val1 +
                        "<br/>Extra email-ids :- " + $("#NotifyToExtra").val() + "" +
                    "<br/>Notify Roles To :- " + valNotify + "" + "</td>";
                    type = '4';
                    $("#lblruletype" + type).val(val1);
                }
                else {
                    if (action == "ruletype7") {
                        str += "<td>Set Value</td>";
                        type = '7';
                        var option_all = $("#PropertyList7 option:selected").text();
                        var val = $("#PropertyList7").val();
                        str += "<td>" + option_all + "=" + $("#Rule7Value").val() + "</td>";
                        var lblruletype7val = $("#lblruletype7").val();
                        lblruletype7val += val + "," + "=" + "," + $("#Rule7Value").val() + "?";
                        $("#lblruletype7").val(lblruletype7val);
                    }
                    else {
                        if (action == "ruletype8") {
                            str += "<td>Invoke Action</td>";
                            type = '8';
                            var option_all = $("#EntityVerb option:selected").text();
                            var val = $("#EntityVerb").val();
                            str += "<td>" + option_all + "</td>";
                            $("#lblruletype8").val(val);
                        }
                        else {
                            str += "<td>Make Records Readonly</td>";
                            var val1 = "Make Records Readonly";
                            str += "<td>" + val1 + "</td>";
                            type = '1';
                            $("#lblruletype" + type).val(val1);
                        }
                    }
                }

            }
        }
        str += "<td><i name=\"lblruletype" + type + "\" onclick=\"deleteRow(this);\" class=\"fam-delete\"></i></td>";
        $('#tblActionList').show();
        $('#tblActionList').append(str);
    }
    $(document).ready(function () {
        $('select[name=RoleList]').multiselect({
            buttonWidth: '100%'
        });
        $('#EntityName').val($('#EntityList :selected').val());
        $('#TimeRuleApplyOn').change(function () {
            var val = $(this).val();
            $('#rulecondition').show();
        });
        $('#ActionList').change(function () {
            var Entity = $('#EntityName').val();
            if (Entity == undefined || Entity.length == 0) {
                $('#dvalert').attr("class", "modal fade in");
                $('#dvalert').attr("aria-hidden", "false");
                $('#dvalert').attr("style", "display:block;");
                $('#alertbody').html("<li>Select Entity</li>");
                $('#ActionList').prop('selectedIndex', 0);
                return false;
            }
            $("#chk1").removeAttr("checked");
            $("#chk2").removeAttr("checked");
            $("#chk3").removeAttr("checked");
            $("#ActionTriggerType").show();
            var SelectedText = $('#ActionList :selected').val();
            $('div[name=ruletype]').each(function (e) {
                $(this).attr("class", "collapse");
            });
            if (SelectedText.length == 1 && (SelectedText == 2 || SelectedText == 3 || SelectedText == 6)) {
                $('#ruletype23').attr("class", "in");
            }
            else {
                if (SelectedText == 4 || SelectedText == 7 || SelectedText == 8) {
                    $('#ruletype' + SelectedText).attr("class", "in");
                } else {
                    if (SelectedText == 1)
                        AddActionInGrid('ruletype1');
                    if (SelectedText == 5)
                        $('#ruletype' + SelectedText).attr("class", "in");
                }
            }
            if (SelectedText == 1 || SelectedText == 2 || SelectedText == 5 || SelectedText == 6)
                $("#chk1").prop("checked", true)
            else
                if (SelectedText == 3 || SelectedText == 7)
                    $("#chk2").prop("checked", true)
                else
                    if (SelectedText == 4 || SelectedText == 8)
                        $("#chk3").prop("checked", true)
                    else
                        $("#ActionTriggerType").hide();
        });
        $('#EntityList').change(function () {

            var SelectedText = $('#EntityList :selected').val();
            if (SelectedText.length == 0) {
                window.location.reload();
                return false;
            }
            $('#EntityName').val(SelectedText);
            // Time based
            $.ajax({
                url: '@Url.Action("GetAllAssociationsofEntity", "BusinessRule")' + '?Entity=' + SelectedText,
                type: "GET",
                cache: false,
                async:false,
                success: function (result) {
                    var optionDOM = "";
                    for (i = 0; i < result.length; i++) {
                        optionDOM += '<option value="' + result[i].Key + '">' + result[i].Value + '</option>';
                    }
                    $("#" + "cmbNotifyTo").html(optionDOM);
                    $("#" + "cmbNotifyTo").multiselect('rebuild');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("error");
                }
            })
            $.ajax({
                url: '@Url.Action("GetPropertiesofEntity", "BusinessRule")' + '?Entity=' + SelectedText,
                type: "GET",
                cache: false,
                async: false,
                success: function (result) {
                    var optionDOM = "";
                    for (i = 0; i < result.length; i++) {
                        optionDOM += '<option value="' + result[i].Name + '">' + result[i].DisplayName + '</option>';
                    }
                    $("#" + "PropertyList").html(optionDOM);
                    $("#" + "SuggestedDynamicValue7").html(optionDOM);
                    $("#" + "PropertyList7").html(optionDOM);
                    $("#" + "PropertyList1").html(optionDOM);
                    $("#" + "PropertyList1").multiselect('rebuild');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("error");
                }
            })
            //
            //Filter dropdown
            $.ajax({
                url: '@Url.Action("GetTabsofEntity", "BusinessRule")' + '?Entity=' + SelectedText,
                type: "GET",
                cache: false,
                async: false,
                success: function (result) {
                    var optionDOM = "";
                    for (i = 0; i < result.length; i++) {
                        var displayName = result[i].Name;
                        if (result[i].Name.indexOf("T_") == 0)
                            displayName = displayName.substr(2);
                        optionDOM += '<option value="' + result[i].AssociationProperty + '">' + displayName + '</option>';
                    }
                    $("#" + "Dropdown").html(optionDOM);
                    $("#" + "Dropdown").multiselect('rebuild');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("error");
                }
            });
            //Entity Verb
            $.ajax({
                url: '@Url.Action("GetVerbsofEntity", "BusinessRule")' + '?Entity=' + SelectedText,
                type: "GET",
                cache: false,
                async: false,
                success: function (result) {
                    var optionDOM = "";
                    for (i = 0; i < result.length; i++) {
                        var displayName = result[i].Value;
                        //if (result[i].key.indexOf("T_") == 0)
                        //    displayName = displayName.substr(2);
                        optionDOM += '<option value="' + result[i].Key + '">' + displayName + '</option>';
                    }
                    $("#" + "EntityVerb").html(optionDOM);
                    $("#" + "EntityVerb").multiselect('rebuild');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    //alert("error");
                }
            });
            //
        });
        $('#ConditionOperator').val($('#OperatorList :selected').val());
        $('#OperatorList').change(function () {
            var SelectedText = $('#OperatorList :selected').val();
            $('#ConditionOperator').val(SelectedText);
        });
    });
    </script>
    @using (Html.BeginForm("CreateBusinessRuleNew", "BusinessRule", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        @Html.AntiForgeryToken();
                            Html.ValidationSummary(true);
                            Html.EnableClientValidation();
                            <div class="row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="panel panel-default AppForm">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="panel-body">
                                                    <div class='col-sm-6'>
                                                        <div class='form-group'>
                                                            <label>Rule Name<span class="text-danger-reg">*</span></label>
                                                            @Html.TextBoxFor(model => model.RuleName, new { @class = "form-control" })
                                                        </div>
                                                    </div>
                                                    <div class='col-sm-6' id="cmbEntity">
                                                        <div class='form-group'>
                                                            <label>Select Entity<span class="text-danger-reg">*</span></label>
                                                            @Html.DropDownList("EntityList", null, "-- Select --", new { @required = "required", @class = "form-control" })
                                                            @Html.ValidationMessageFor(model => model.EntityName)
                                                            @Html.TextBoxFor(model => model.EntityName, new { @class = "form-control hidden" })
                                                        </div>
                                                    </div>

                                                    <div class='col-sm-6'>
                                                        <div class='form-group'>
                                                            <label>Apply to following roles</label>
                                                            <br />
                                                            @Html.DropDownList("RoleList", null, new { @multiple = "multiple" })
                                                            @Html.TextBox("RoleListValue", null, new { @class = "form-control hidden" })
                                                            @Html.ValidationMessageFor(model => model.Roles)
                                                        </div>
                                                    </div>
                                                    <div class='col-sm-6'>
                                                        <div class='form-group'>
                                                            <label>Disable Rule</label><br />
                                                            @Html.CheckBoxFor(model => model.Disable)
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 col-sm-12 col-xs-12" id="conddiv">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading clearfix">
                                                            <i class="fam-script-lightning pull-left"></i>
                                                            <h3 style="padding-left:10px;" class="panel-title"><label class="alert-warning">Define condition to apply rule</label> </h3>
                                                        </div>
                                                        <div class="panel-body">
                                                            <div class="row">
                                                                <div class='col-sm-6 col-md-6 col-xs-12'>
                                                                    <label class="col-sm-5 col-md-5 col-xs-12">Select Condition Type</label>
                                                                    @Html.DropDownList("TimeRuleApplyOn", null, "-- Select --", new { @style = "width:150px;", @class = "form-control col-sm-7 col-md-7 col-xs-12" })
                                                                    @Html.TextBox("TimeRuleApplyOnValue", null, new { @class = "form-control hidden" })
                                                                </div>
                                                            </div>
                                                            <div class="clearfix"></div>
                                                            <div class="panel panel-default AppForm" id="rulecondition" style="display:none;">
                                                                <div class="panel-body">
                                                                    <div class="row">
                                                                        <div class='col-sm-4'>
                                                                            <div class='form-group'>
                                                                                <label>Select Property <span class="text-danger-reg">*</span></label>
                                                                                @Html.DropDownList("PropertyList", null, new { @class = "form-control" })
                                                                            </div>
                                                                        </div>
                                                                        <div class='col-sm-4'>
                                                                            <div class='form-group'>
                                                                                <label>Select Operator <span class="text-danger-reg">*</span></label>
                                                                                <select class="form-control" id="OperatorList" onchange="GetSuggestedValues(this);">
                                                                                    <option value="=">Equals to</option>
                                                                                    <option value=">">Greater than</option>
                                                                                    <option value="<">Less than</option>
                                                                                    <option value="<=">Less than Or Equals to</option>
                                                                                    <option value=">=">Greater than Or Equals to</option>
                                                                                    <option value="Contains">Contains</option>
                                                                                    <option value="!=">Not Equals to</option>
                                                                                    <option value="=">Pick From List</option>
                                                                                </select>
                                                                                @Html.TextBox("ConditionOperator", null, new { @class = "form-control hidden" })
                                                                            </div>
                                                                        </div>
                                                                        <div class='col-sm-4'>
                                                                            <div class='form-group'>
                                                                                <label>Property Value <span class="text-danger-reg">*</span></label>
                                                                                @Html.TextBox("ConditionValue", null, new { @class = "form-control" })
                                                                                <div style="display:none;" id="dvSuggestedPropertyValue">
                                                                                    @Html.DropDownList("SuggestedPropertyValue", null, "-- Select --", new { @onchange = "FillSugestedValues();", @class = "chosen-select form-control", @style = "margin-top:8px;", @HostingName = "", @dataurl = "" })
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" id="btnAddAction4" onclick="AddConditionInGrid()" class="btn btn-primary btn-sm">Add Condition</button>
                                                                </div>
                                                            </div>
                                                            <div id="Des_Table" style="padding-top:5px;" class="table-responsive" style="overflow-x:auto;">
                                                                <table id="tblConditionList" style="display:none;" class="table table-striped table-bordered table-hover table-condensed">
                                                                    <thead>
                                                                        <tr>
                                                                            <th class="col1">Property</th>
                                                                            <th class="col1">Operator</th>
                                                                            <th class="col1">Value</th>
                                                                            <th class="col1">Remove</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tr></tr>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 col-sm-12 col-xs-12">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading clearfix">
                                                            <i class="fam-lightbulb pull-left"></i>
                                                            <h3 style="padding-left:10px;" class="panel-title"><label class="alert-warning">Define Actions</label></h3>
                                                        </div>
                                                        <div class="panel-body">
                                                            <div class="row">
                                                                <div class='col-sm-6 col-md-6 col-xs-12'>
                                                                    <label style="margin-left:20px; " class="pull-left">Add Action </label>
                                                                    <select class="form-control" style="width:150px;" id="ActionList" data-placement="top">
                                                                        <option value="0">--Select Action--</option>
                                                                        <option value="1">Make Records Readonly</option>
                                                                        <option value="2">Make Fields Readonly</option>
                                                                        <option value="3">Make Fields Mandatory</option>
                                                                        <option value="4">Email Notification</option>
                                                                        <option value="5">Filter Dropdown</option>
                                                                        <option value="6">Make Fields Hidden</option>
                                                                        <option value="7">Set Value</option>
                                                                        <option value="8">Invoke Action</option>
                                                                    </select>
                                                                    @Html.TextBox("ActionListValue", null, new { @class = "form-control hidden" })
                                                                </div>
                                                                <div class='col-sm-6 col-md-6 col-xs-12' id="ActionTriggerType" style="display:none;">
                                                                    <input id="chk1" type="checkbox" disabled />On Fetch
                                                                    <input id="chk2" type="checkbox" disabled style="margin-left:5px;" />On Save
                                                                    <input id="chk3" type="checkbox" disabled style="margin-left:5px;" />After Save
                                                                </div>
                                                            </div>
                                                            <div id="ruletype4" class="collapse" name="ruletype">
                                                                <div class="panel panel-default AppForm" style="border:0px !important">

                                                                    <div class="panel-body" style="border:0px !important">
                                                                        <div class='col-sm-6'>
                                                                            <div class='form-group'>
                                                                                <label>Notify within days <span class="text-danger-reg">*</span></label>
                                                                                @Html.TextBox("TimeValue", null, new { @placeholder = "Days within to notify, 0 for immediate", @required = "required", @class = "form-control" })
                                                                            </div>
                                                                        </div>
                                                                        <div class='col-sm-6'>
                                                                            <div class='form-group' name="dvNotifyTo" id="dvNotify">
                                                                                <label>Notify to <span class="text-danger-reg">*</span></label>
                                                                                <br />
                                                                                @Html.DropDownList("cmbNotifyTo", null, new { @multiple = "multiple" })
                                                                                @Html.TextBox("NotifyTo", null, new { style = "border:none !important;Width:0px !important;" })


                                                                            </div>
                                                                        </div>

                                                                        <div class='col-sm-6'>
                                                                            <div class='form-group'>
                                                                                <label>Specify extra email-ids </label>
                                                                                @Html.TextArea("NotifyToExtra", null, new { @placeholder = "Notify some these people also", @class = "form-control" })
                                                                            </div>
                                                                        </div>
                                                                        <div class='col-sm-6'>
                                                                            <div class='form-group' name="dvNotifyRoleTo" id="dvRoleNotify">
                                                                                <label>Notify to Roles <span class="text-danger-reg"></span></label>
                                                                                <br />
                                                                                @Html.TextBox("NotifyToRole", null, new { @class = "form-control hidden" })
                                                                                @Html.DropDownList("NotifyRoleList", null, new { @multiple = "multiple" })
                                                                            </div>
                                                                        </div>

                                                                        <div class='col-sm-12'>
                                                                            <div class='form-group'>
                                                                                <label>Notification Message </label>
                                                                                <label>(###Record### to display record, ###RecordLink### to display hyperlink of record)</label>
                                                                                @Html.TextArea("AlertMessage", null, new { @placeholder = "Alert Message for notification", @class = "form-control", @row = "50" })
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <button type="button" id="btnAddAction4" onclick="AddActionInGrid('ruletype4')" class="btn btn-primary btn-sm">Add Action</button>

                                                                </div>
                                                            </div>
                                                            <div id="ruletype23" class="collapse" name="ruletype">
                                                                <div class="panel panel-default AppForm">
                                                                    <div class="panel-body">
                                                                        <div class='form-group'>
                                                                            <div class='col-sm-4'>
                                                                                <label>Select Properties<span class="text-danger-reg">*</span></label>
                                                                            </div>
                                                                            <div class='col-sm-6'>
                                                                                @Html.DropDownList("PropertyList1", null, new { @multiple = "multiple" })
                                                                                @Html.TextBox("PropertyList1Value", null, new { @class = "form-control hidden" })
                                                                            </div>
                                                                        </div>
                                                                        <button type="button" id="btnAddAction23" onclick="AddActionInGrid('ruletype23')" class="btn btn-primary btn-sm">Add Action</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="ruletype5" class="collapse" name="ruletype">
                                                                <div class="panel panel-default AppForm">
                                                                    <div class="panel-body">
                                                                        <div class='form-group'>
                                                                            <div class='col-sm-4'>
                                                                                <label>Select Dropdown<span class="text-danger-reg">*</span></label>
                                                                            </div>
                                                                            <div class='col-sm-6'>
                                                                                @Html.DropDownList("Dropdown", null, "-- Select --", new { @multiple = "multiple" })
                                                                            </div>
                                                                        </div>
                                                                        <button type="button" id="btnAddAction5" onclick="AddActionInGrid('ruletype5')" class="btn btn-primary btn-sm">Add Action</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="ruletype7" class="collapse" name="ruletype">
                                                                <div class="panel panel-default AppForm">
                                                                    <div class="panel-body">
                                                                        <div class="row">
                                                                            <div class='col-sm-4'>
                                                                                <div class='form-group'>
                                                                                    <label>Select Property <span class="text-danger-reg">*</span></label>
                                                                                    @Html.DropDownList("PropertyList7", null, "-- Select --", new { @required = "required", @class = "form-control" })
                                                                                    @Html.TextBox("PropertyList7Value", null, new { @class = "form-control hidden" })
                                                                                </div>
                                                                            </div>
                                                                            <div class='col-sm-4'>
                                                                                <div class='form-group'>
                                                                                    <label> Value Type <span class="text-danger-reg">*</span></label>
                                                                                    <select class="form-control" id="Rule7Operator" onchange="GetConstantValue();">
                                                                                        <option value="1">Constant</option>
                                                                                        <option value="2">Pick From List</option>
                                                                                        <option value="3">Dynamic</option>
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <div class='col-sm-3'>
                                                                                <div class='form-group'>
                                                                                    <label>Property Value <span class="text-danger-reg">*</span></label>
                                                                                    @Html.TextBox("Rule7Value", null, new { @class = "form-control" })
                                                                                    <div style="display:none;" id="dvRule7Value">
                                                                                        @Html.DropDownList("SuggestedPropertyValue7", null, "-- Select --", new { @onchange = "FillSugestedValues7();", @class = "chosen-select form-control", @style = "margin-top:8px;", @HostingName = "", @dataurl = "" })
                                                                                    </div>
                                                                                    <div style="display:none;" id="dvRule7DynamicValue">
                                                                                        @Html.DropDownList("SuggestedDynamicValue7", null, "-- Select --", new { @onchange = "GetSecondLevelAttribute();", @class = "form-control", @style = "margin-top:8px;", @HostingName = "", @dataurl = "" })
                                                                                        @Html.DropDownList("SuggestedDynamicValue71", null, "-- Select --", new { @onchange = "FillSugestedDynamicValues7();", @class = "form-control", @style = "margin-top:8px;", @HostingName = "", @dataurl = "" })
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <button type="button" id="btnAddAction7" onclick="AddActionInGrid('ruletype7')" class="btn btn-primary btn-sm">Add Action</button>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div id="ruletype8" class="collapse" name="ruletype">
                                                                <div class="panel panel-default AppForm">
                                                                    <div class="panel-body">
                                                                        <div class='form-group'>
                                                                            <div class='col-sm-4'>
                                                                                <label>Select Verb<span class="text-danger-reg">*</span></label>
                                                                            </div>
                                                                            <div class='col-sm-6'>
                                                                                @Html.DropDownList("EntityVerb", null, "-- Select --", new { @multiple = "multiple" })
                                                                            </div>
                                                                        </div>
                                                                        <button type="button" id="btnAddAction8" onclick="AddActionInGrid('ruletype8')" class="btn btn-primary btn-sm">Add Action</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="Des_Table" style="padding-top:5px;" class="table-responsive" style="overflow-x:auto;">
                                                                <table id="tblActionList" style="display:none;table-layout: fixed;" class="table table-striped table-bordered table-hover table-condensed">
                                                                    <thead>
                                                                        <tr>
                                                                            <th class="col1">Action Type</th>
                                                                            <th class="col1">Parameter</th>
                                                                            <th class="col1">Remove</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tr></tr>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @Html.ActionLink("Cancel", "Cancel", new { UrlReferrer = ViewData["BusinessRuleParentUrl"] }, new { @class = "class=btn btn-default btn-sm" })
                            @*<button type="button" class="btn btn-default btn-sm" data-dismiss="modal" aria-hidden="true">Cancel</button>*@
                            <input type="submit" value="Create" class="btn btn-primary btn-sm" />
                            @Html.TextBox("lblruletype1", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype2", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype3", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype4", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype5", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype6", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype7", null, new { @class = "hidden" })
                            @Html.TextBox("lblruletype8", null, new { @class = "hidden" })
                            @Html.TextBox("lblrulecondition", null, new { @class = "hidden" })
                            <div class="modal fade" aria-hidden="true" id="dvalert">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" onclick="closealert();" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <center><h4 class="modal-title">Validation Alert</h4></center>
                                            <div class="alert alert-warning" id="alertbody">
                                            </div>
                                            <button type="button" class="btn btn-default btn-sm" onclick="closealert();" data-dismiss="modal" aria-hidden="true">OK</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
    }
    <script type="text/javascript">
    $(document).ready(function () {
        $('select[name=cmbNotifyTo]').multiselect({
            buttonWidth: '100%'
        });
        $('select[name=NotifyRoleList]').multiselect({
            buttonWidth: '100%'
        });
        $('select[name=PropertyList1]').multiselect({
            buttonWidth: '100%'
        });
        $('select[name=Dropdown]').multiselect({
            buttonWidth: '100%'
        });
        $('select[name=EntityVerb]').multiselect({
            buttonWidth: '100%'
        });
    });
    </script>
    <script>
    $("input[type='submit']").click(function () {

        var result = false;
        $(document).find("input[id*='lblruletype']").each(function () {
            if ($(this).val() != null && $(this).val().length > 0) {
                result = true;
            }
        });
        if (!result) {
            alert("At least one action required to save Business Rule.")
            return false;
        }
        else {
            if ($("#" + "lblruletype4").val() == null || $("#" + "lblruletype4").val().length == 0) {
                if ($("#" + "lblrulecondition").val() == null || $("#" + "lblrulecondition").val().length == 0) {
                    alert("Condition Required for this action.")
                    return false;
                }
            }
        }
    });
    </script>

    <script>
    $("form").submit(function () {
        try {
            $('#PropertyList1Value').val(($('#PropertyList1').val()));
            $('#PropertyList7Value').val(($('#PropertyList7').val()));
            $('#RoleListValue').val(($('#RoleList').val()));
            $('#NotifyToRole').val(($('#NotifyRoleList').val()));
            $('#TimeRuleApplyOnValue').val($('#TimeRuleApplyOn').val());
        } catch (ex) { }
        $('div[name=dvNotifyTo]').each(function (e) {
            catname = $(this).attr('id');
            var firstInput = $("#" + catname).find('input[type=text],input[type=password],input[type=radio],input[type=checkbox],textarea,select').filter(':visible:first');
            var firstButton = $("#" + catname).find('button').filter(':first');
            var txtid = firstInput.attr('id');
            var btntitle = firstButton.attr('title');
            var value = $('#cmbNotifyTo').val();
            if (firstButton != null) {
                if (btntitle != 'None selected')
                    $("#" + txtid).val(value);
                else
                    $("#" + txtid).val('');
            }
        });
        //if ($(this).find('.input-validation-error').length == 0) {
        //    $(this).find(':submit').attr('disabled', 'disabled');
        //}
    });
    </script>



